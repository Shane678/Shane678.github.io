---
title: ES6 正则之中文问题
tags:
  - JavaScript
  - ES6
  - RegExp
categories:
  - 前端
author: Shane
img: 'https://myimagebed-1302088591.cos.ap-nanjing.myqcloud.com/%E6%96%87%E7%AB%A0%E7%89%B9%E5%BE%81%E5%9B%BE/37.jpg'
toc: true
summary: ES5 如何在正则中处理中文问题，如果是多个字节呢？ES6 有什么高招？
date: 2020-07-25 18:18:20
---

# ES6 正则之中文问题

## 0 前言

ES5 中，可以通过中文在 Unicode 中的范围去筛选，但如果遇到的是多个字节的字符比如四个字节的字符，就没什么办法了。

ES6 中使用 u 修饰符（可以识别 Unicode 码点大于 \uffff 的字符）处理正则中的中文问题。

/u 表示按 Unicode（utf-8）匹配（主要针对多字节比如汉字）

> :information_source:**Note**
>
> “𠮷”这个字读 ji（第二声），是“吉”字的异形体，Unicode 码点 U+20BB7（http://www.fileformat.info/info/unicode/char/20bb7/index.htm）

## 1 正则表达式处理 4 个字节的字符

```javascript
let s = '𠮷'
let s2 = '\uD842\uDFB7' // 参考“𠮷”字的 C/C++/Java source code "\uD842\uDFB7"，用 4 个字节表示的一个字符

// ES5 时，正则会把诸如上面原本代表一个字符的码点当成两个字符处理
console.log(/^\uD842/.test(s2)) // true
// 加上 u 之后，就会把“\uD842\uDFB7”当成一个字符，所以字符“\uD842”和字符“\uD842\uDFB7”不匹配
console.log(/^\uD842/u.test(s2)) // false
// 很明显，加了 u 之后的结果才是我们想要的（字符“𠮷”和字符“\uD842\uDFB7”表示的是同一个字符）
```

## 2 正则表达式元字符中的“.”

```javascript
let s = '𠮷'
// ES5 时，从字符串的起始位置到结束位置，匹配除换行符（\n、\r）之外的任何单个字符
console.log(/^.$/.test(s)) // false
// 对于“.”来说，也要加 u，才能匹配到大于两个字节的字符
console.log(/^.$/u.test(s)) // true
```

## 3 在正则表达式中使用 Unicode 码点

适用于各种字节的字符，注意格式为：`/\u{Unicode 码点值}/u`

```javascript
let s = '𠮷'
// 四个字节的字符“𠮷”
console.log(/\u{20BB7}/u.test(s)) // true
// 一个字节的字符“a”
console.log(/\u{61}/u.test('a')) // true
// 错误写法（未加 u）：
console.log(/\u{20BB7}/.test(s)) // false
console.log(/\u{61}/.test('a')) // false
```

## 4 量词

```javascript
console.log(/𠮷{2}/u.test('𠮷𠮷')) // true
// 不加 u，结果与预期不符：
console.log(/𠮷{2}/.test('𠮷𠮷')) // false
```

## 5 i 修饰符

```javascript
// i：不区分(ignore)大小写
// 大写字母 K 的编码为 "\u212A"
// 不加 u ：
console.log(/[a-z]/i.test('\u212A')) // false
// 加 u：
console.log(/[a-z]/iu.test('\u212A')) // true
```

> 总结：碰到有中文字符的情况，通通加上 u 就行了。